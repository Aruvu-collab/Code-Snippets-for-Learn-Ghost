    <script>
    (function() {
        const CONFIG = {
            GHOST_URL: 'https://learn.livinglabs.network',
            API_KEY: 'd43ba92c8b1434af08d837c579',
            API_VERSION: 'v3'
        };

        // Store state for each filter instance
        const instances = new Map();

        function buildFilterQuery(filterConfig) {
            const tags = filterConfig.getAttribute('data-tags');
            const requiredTags = filterConfig.getAttribute('data-required-tags');
            const optionalTags = filterConfig.getAttribute('data-optional-tags');
            const logic = filterConfig.getAttribute('data-logic') || 'and';

            let filters = [];

            if (tags) {
                const tagList = tags.split(',').map(tag => tag.trim()).filter(tag => tag);

                if (logic === 'and') {
                    filters.push(tagList.map(tag => `tag:${tag}`).join('+'));
                } else if (logic === 'or') {
                    filters.push(tagList.map(tag => `tag:${tag}`).join(','));
                }
            }

            if (requiredTags && optionalTags) {
                const required = requiredTags.split(',').map(tag => tag.trim()).filter(tag => tag);
                const optional = optionalTags.split(',').map(tag => tag.trim()).filter(tag => tag);
                
                const requiredFilter = required.map(tag => `tag:${tag}`).join('+');
                const optionalFilter = optional.map(tag => `tag:${tag}`).join(',');
                
                if (requiredFilter && optionalFilter) {
                    filters.push(`${requiredFilter}+(${optionalFilter})`);
                } else if (requiredFilter) {
                    filters.push(requiredFilter);
                } else if (optionalFilter) {
                    filters.push(optionalFilter);
                }
            }

            return filters.join('+');
        }

        async function fetchPosts(filterQuery, page = 1) {
            const baseUrl = CONFIG.GHOST_URL.endsWith('/') ? CONFIG.GHOST_URL.slice(0, -1) : CONFIG.GHOST_URL;
            const url = `${baseUrl}/ghost/api/${CONFIG.API_VERSION}/content/posts/?key=${CONFIG.API_KEY}&filter=${encodeURIComponent(filterQuery)}&limit=15&page=${page}&fields=id,title,url,excerpt,feature_image,published_at&include=tags,authors`;
            
            const response = await fetch(url);
            if (!response.ok) throw new Error(`HTTP ${response.status}`);
            return response.json();
        }

        function createPostCard(post) {
            const card = document.createElement('article');
            card.className = 'gh-card';
            card.onclick = () => window.open(post.url, '_blank');

            const imageHtml = post.feature_image 
                ? `<div class="gh-card-image"><img src="${post.feature_image}" alt="${post.title}"></div>`
                : '';

            card.innerHTML = `
                ${imageHtml}
                <div class="gh-card-content">
                    <h3 class="gh-card-title">${post.title}</h3>
                    <p class="gh-card-excerpt">${post.excerpt || ''}</p>
                </div>
            `;

            return card;
        }

        function displayPosts(posts, containerId, append = false) {
            const container = document.getElementById(containerId);
            
            if (!append) {
                container.innerHTML = '';
            }

            if (posts.length === 0 && !append) {
                container.innerHTML = '<div class="loading">No posts found matching the specified tags.</div>';
                return;
            }

            posts.forEach(post => {
                const card = createPostCard(post);
                container.appendChild(card);
            });
        }

        function createLoadMoreHandler(instanceId) {
            return async function() {
                const instance = instances.get(instanceId);
                if (!instance.hasMore) return;
                
                try {
                    instance.currentPage++;
                    const data = await fetchPosts(instance.filterQuery, instance.currentPage);
                    displayPosts(data.posts, instance.containerId, true);
                    
                    instance.hasMore = instance.currentPage < data.meta.pagination.pages;
                    document.getElementById(instance.loadMoreId).style.display = instance.hasMore ? 'block' : 'none';
                } catch (error) {
                    console.error('Error loading more posts:', error);
                }
            };
        }

        async function initializeFilter(filterConfig, containerId, loadMoreId) {
            try {
                const filterQuery = buildFilterQuery(filterConfig);
                
                if (!filterQuery) {
                    throw new Error('No tags specified in filter configuration');
                }

                // Create instance state
                const instanceId = filterConfig.id;
                instances.set(instanceId, {
                    filterQuery,
                    containerId,
                    loadMoreId,
                    currentPage: 1,
                    hasMore: true
                });

                console.log(`Filter query for ${instanceId}:`, filterQuery);
                
                // Load initial posts
                const data = await fetchPosts(filterQuery, 1);
                displayPosts(data.posts, containerId);
                
                // Setup load more button
                const instance = instances.get(instanceId);
                instance.hasMore = data.meta.pagination.pages > 1;
                const loadMoreBtn = document.getElementById(loadMoreId);
                if (loadMoreBtn) {
                    loadMoreBtn.style.display = instance.hasMore ? 'block' : 'none';
                    loadMoreBtn.onclick = createLoadMoreHandler(instanceId);
                }
                
            } catch (error) {
                console.error(`Error initializing filter ${filterConfig.id}:`, error);
                const container = document.getElementById(containerId);
                if (container) {
                    container.innerHTML = '<div class="error">Error loading posts. Please check the console for details.</div>';
                }
            }
        }

        async function init() {
            // Initialize all filter sections
            const filterConfigs = [
                { config: document.getElementById('filter-config-1'), container: 'posts-container-1', loadMore: 'load-more-1' },
                { config: document.getElementById('filter-config-2'), container: 'posts-container-2', loadMore: 'load-more-2' }
            ];

            for (const { config, container, loadMore } of filterConfigs) {
                if (config) {
                    await initializeFilter(config, container, loadMore);
                }
            }
        }

        // Initialize when page loads
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    })();
    </script>